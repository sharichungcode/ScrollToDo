<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScrollToDo - Organize, Prioritize, and Conquer</title>
    {% load static %}
    <link href="{% static 'tasks/styles.css' %}" rel="stylesheet">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Roboto:wght@400;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="icon" href="{% static 'favicon.ico' %}" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body class="d-flex flex-column min-vh-100 bg-light">

    <!-- Navigation Bar -->
    {% include 'tasks/navbar.html' %}

    <div class="container mt-3 mb-5">
        <!-- Key Actions Section -->
        <div class="row mb-4">
            <div class="col-md-6 my-2">
                <button class="btn btn-primary btn-block" data-toggle="modal" data-target="#addTaskModal"><i class="fas fa-plus"></i> Add New Task</button>
            </div>
            <div class="col-md-6 mt-2">
                <button class="btn btn-secondary btn-block" data-toggle="modal" data-target="#addTaskListModal"><i class="fas fa-list"></i> Add New Task List</button>
            </div>
        </div>

        <!-- Add New Task Modal -->
        <div class="modal fade" id="addTaskModal" tabindex="-1" aria-labelledby="addTaskModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addTaskModalLabel">Add New Task</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form>
                            <div class="form-group">
                                <label for="taskTitle">Task Title</label>
                                <input type="text" class="form-control" id="taskTitle" required>
                            </div>
                            <div class="form-group">
                                <label for="taskDescription">Description</label>
                                <textarea class="form-control" id="taskDescription" rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="taskDeadline">Deadline</label>
                                <input type="date" class="form-control" id="taskDeadline" required>
                            </div>
                            <button type="submit" class="btn btn-primary">Add Task</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add New Task List Modal -->
        <div class="modal fade" id="addTaskListModal" tabindex="-1" aria-labelledby="addTaskListModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addTaskListModalLabel">Add New Task List</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form>
                            <div class="form-group">
                                <label for="taskListTitle">Task List Title</label>
                                <input type="text" class="form-control" id="taskListTitle" required>
                            </div>
                            <button type="submit" class="btn btn-primary">Add Task List</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="row d-flex align-items-stretch">
            <!-- Task Completion Metrics -->
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 class="card-title">Tasks Completed Today</h5>
                        <p class="card-text"><strong>5</strong> tasks completed on <strong>October 10, 2023</strong></p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 class="card-title">Tasks Completed This Week</h5>
                        <p class="card-text"><strong>20</strong> tasks completed from <strong>October 4, 2023</strong> to <strong>October 10, 2023</strong></p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 class="card-title">Deadline Performance</h5>
                        <p class="card-text"><strong>15</strong> out of <strong>20</strong> tasks completed for October 2023</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Upcoming Deadlines Section -->
        <h3 class="mb-4">Upcoming Deadlines</h3>
        <div class="row d-flex align-items-stretch" id="upcoming-deadlines">
            <div class="col-md-4 mb-4" draggable="true">
                <div class="card h-100">
                    <div class="card-body">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="task1">
                            <label class="form-check-label" for="task1">
                                <strong>Task Title 1</strong>
                            </label>
                        </div>
                        <p class="card-text">Short description of the task.</p>
                        <p class="card-text"><small class="text-muted">Deadline: October 15, 2023</small></p>
                        <button class="btn btn-link p-0"><i class="fas fa-edit"></i> Edit</button>
                    </div>
                </div>
            </div>
            <!-- Repeat similar blocks for other tasks -->
        </div>

        <!-- Your Task Lists Section -->
        <h3 class="mb-4">Your Task Lists</h3>
        <div class="row d-flex align-items-stretch">
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 class="card-title">Task List Title 1</h5>
                        <p class="card-text">5 tasks remaining</p>
                        <div class="progress mb-2">
                            <div class="progress-bar" role="progressbar" style="width: 50%;" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100">50%</div>
                        </div>
                        <p class="card-text"><small class="text-muted">Deadline: October 20, 2023</small></p>
                        <button class="btn btn-link p-0"><i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
            </div>
            <!-- Repeat similar blocks for other task lists -->
        </div>
    </div>

    <!-- Footer -->
    {% include 'tasks/footer.html' %}

    <!-- Bootstrap JavaScript and dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <!-- Drag and Drop Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const draggables = document.querySelectorAll('[draggable="true"]');
            const containers = document.querySelectorAll('#upcoming-deadlines');

            draggables.forEach(draggable => {
                draggable.addEventListener('dragstart', () => {
                    draggable.classList.add('dragging');
                });

                draggable.addEventListener('dragend', () => {
                    draggable.classList.remove('dragging');
                });
            });

            containers.forEach(container => {
                container.addEventListener('dragover', e => {
                    e.preventDefault();
                    const afterElement = getDragAfterElement(container, e.clientY);
                    const draggable = document.querySelector('.dragging');
                    if (afterElement == null) {
                        container.appendChild(draggable);
                    } else {
                        container.insertBefore(draggable, afterElement);
                    }
                });
            });

            function getDragAfterElement(container, y) {
                const draggableElements = [...container.querySelectorAll('[draggable="true"]:not(.dragging)')];

                return draggableElements.reduce((closest, child) => {
                    const box = child.getBoundingClientRect();
                    const offset = y - box.top - box.height / 2;
                    if (offset < 0 && offset > closest.offset) {
                        return { offset: offset, element: child };
                    } else {
                        return closest;
                    }
                }, { offset: Number.NEGATIVE_INFINITY }).element;
            }
        });
    </script>
</body>
</html>
